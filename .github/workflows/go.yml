name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.15

    - name: Build
      run: go build -v ./...

    - name: Test
      run: go test -v ./...
    
    - name: IO Scan
      # You may pin to the exact commit or the version.
      # uses: synopsys-sig/intelligent-security-scan@6940a88f5a0062304657dd62e7d3cee3b5bc9e57
      uses: sig-chakrava/io-scan@2518e0f37d073715c51b656278c176c021ba9c3f
      with:
      # The server Host URL for Intelligent Scan Engine eg http://localhost:1111 or https://21b7.ngrok.io
        ioServerUrl: http://0046b9e044b4.ngrok.io
        # The server password for Intelligent Scan Engine
        ioServerToken: 55748e69-907b-4998-94eb-cf75323208e9
        # The server Host URL for Intelligent Scan Workflow Engine eg http://localhost:1111 or https://21b7.ngrok.io
        workflowServerUrl: http://172.17.79.29:9091

    - name: Get result json
      uses: actions/upload-artifact@v2
      with:
        name: manifest-update
        path: result.json
